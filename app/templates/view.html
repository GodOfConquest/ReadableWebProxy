<!-- extend base layout -->
{% set title = "Loading" %}
{% extends "__base.html" %}

{% block content %}
	{% include '_block_flash.html' %}
	<div class="well breakword">

		<div>
			<p>
				<a href='/render?{{ {"url" : req_url} | urlencode }}'>Raw Render</a> |
				<a href='{{req_url}}'>Original content</a> |
				Ignore-cache: {{"no" if not ignore_cache else "yes"}}
				(<a href='/view?{{ {"url" : req_url, "nocache" : "true"} | urlencode }}'>yes</a>, <a href='/view?{{ {"url" : req_url} | urlencode | safe }}'>no</a>)
				| Age: <span class='cachestate'>loading...</span>
			</p>

		</div>
		<hr>
		<div id='content' class='easyreading'>
			<div class="center-block text-center">
				<h4>Loading</h4>
				<p>Please Wait.</p>
				<img src="/static/loading.gif">
				<br>
				<br>
			</div>
		</div>
		<hr>
		<div>
			<p>
				Remote URL: <a href='{{req_url}}'>{{req_url}}</a>
			</p>
			<p>
				<a href='/render?{{ {"url" : req_url} | urlencode }}'>Raw Render</a> |
				<a href='{{req_url}}'>Original content</a> |
				Ignore-cache: {{"no" if not ignore_cache else "yes"}}
				(<a href='/view?{{ {"url" : req_url, "nocache" : "true"} | urlencode }}'>yes</a>, <a href='/view?{{ {"url" : req_url} | urlencode | safe }}'>no</a>)
				| Age: <span class='cachestate'>loading...</span>
			</p>

		</div>
	</div>

{% endblock %}


{% block footer %}
	{% if g.user.is_mod() %}
		{% include '_block_admin_scripts.html' %}
	{% endif %}
	<script>

		function content_load_cb(data, textStatus, jqXHR)
		{
			var content = $("#content");
			var cachest = $(".cachestate");
			console.log(content);
			console.log(data);
			console.log(textStatus);

			cachest.text(data['cachestate']);
			content.html(data['contents']);
			document.title = "ReadProxy - " + data['title']
		};
		function content_load_fail(jqXHR, textStatus, errorThrown)
		{
			alert("Failed to fetch content!\nError: " + errorThrown + "\nStatus text: " + textStatus);
		}
		{% if ignore_cache %}
			var url = "/render?{{ {"url" : req_url, "nocache" : "true"} | urlencode | safe }}";
		{% else %}
			var url = "/render?{{ {"url" : req_url} | urlencode | safe }}";
		{% endif %}

		$.ajax({
			url      : url,
			success  : content_load_cb,
			error    : content_load_cb,
			dataType : "json",

		})


	</script>
	<style>
		div.easyreading
		{
			margin:0 auto;
			max-width: 500px;
			font-family: Arial;
			font-size: large;
			word-wrap: break-word;
		}
	</style>
{% endblock %}

